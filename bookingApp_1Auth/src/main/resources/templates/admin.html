<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
        rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <link rel="stylesheet"
        href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"/>
  <script
          src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>


  <!--  //I use the media=print and loads my stylesheet-->
  <link rel="stylesheet" media="print"  href="/css/assets_css_fullcalendar.print.css">
  <link rel="stylesheet" href="/css/fullcalendar.css">

  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.4/index.global.min.js"></script>


  <style>

    body {
      margin: 40px 10px;
      padding: 0;
      font-family: Helvetica,Arial,Verdana,sans-serif;
      font-size: 14px;
    }

    #calendar {
      max-width: 900px;
      margin: 0 auto;
    }
    .no-titlebar .ui-dialog-titlebar {
      display: none;
    }
    #description { margin-bottom:12px; width:100%; padding: .4em; }

    #fieldset { padding:0; border:0; margin-top:25px; height: 200px;}
    .hide_block
    {
      display:none  !important;
    }


  </style>
  <title>Administration</title>


</head>
<body>



<div th:replace="~{header :: header}"></div>

<div id='script-warning'  >
  <div class="btn-group-vertical btn-group-sm" role="group" aria-label="author button">

    <h3>OnLine Booking App Administration </h3>
    <div class="btn-group-sm">
      <button type="button" id="whichuser">Author:Administrator</button>
    </div><hr>
    <div class="container">
      <div class="row">
        <div class="col-md-6">
          <div class="login-container">
          <h4>Loading Last Year/Semester Bookings</h4><hr>
<!--   th:action="@{/loadLastYear}"         -->
          <form  method="post">

            <div class="form-group">
              <label for="adminusername">Select user</label>
              <input type="text" id="adminusername" name="adminusername" placeholder="Enter your username" list="usernames" required>
              <datalist id="usernames">
                <option th:each="user : ${users}"  th:text="${user}"></option>
              </datalist>
            </div><br>

            <div class="form-group">
              <label for="adminlabname">Select lab</label>
              <input type="text" id="adminlabname" name="adminlabname" placeholder="Enter the lab name" list="labs" required>
              <datalist id="labs">
                <option th:each="lab : ${labs}"  th:text="${lab}"></option>
              </datalist>
            </div><br>

            <div class="form-group">
              <label for="startSemesterDate"><b>Έναρξη Εξαμήνου: </b></label>
              <input type="date" id="startSemesterDate" name="startSemesterDate" required />
            </div><br>

            <div class="form-group">
              <button type="submit" id="loadForm" >Load</button>
              <button type="reset">Reset</button>
            </div>
            <div class="form-group">

            </div>
          </form>

          <div th:if="${param.error}" class="message error">
            <p>Invalid username or password. Please try again.</p>
          </div>
          <div th:if="${param.logout}" class="message success">
            <p>You have been logged out successfully.</p>
          </div>
        </div>
        </div>

        <div class="col-md-6 ">
          <div>
            <h4>Backing up database information</h4><br><hr>
          </div>
          <form th:action="@{/exportDatabase}" method="post">
            <div class="form-group">
              <label for="exportDatabase">Export Database </label>
              <input type="email" id="exportDatabase" name="exportDatabase" placeholder="Given Database">
            </div><br>
            <div class="form-group">
              <button type="submit" class="btn-group-sm">Submit</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>


</body>
</html>


<script>

  const adminusername = document.getElementById("adminusername");
  const adminlabname = document.getElementById("adminlabname");
  const startSemester = document.getElementById("startSemesterDate");
  const load = document.getElementById("loadForm");


  load.addEventListener('click', async function (e) {
    e.preventDefault();

    console.log("in event listener");

    let bodyInfo = "adminusername="+ adminusername.value+"&adminlabname="+adminlabname.value + "&startSemesterDate="+startSemester.value;

    try {
      const response = await fetch("loadLastYear", {
        method: 'POST',
        headers: {
          'Content-Type': 'text/plain'
        },
        body: bodyInfo
      });

      if (response.ok) {
        console.log("bookings loaded successfuly!");
        location.reload();
      } else {
        console.error("an Error occured!");
        alert("Error loading bookings! Try again!");
      }
    }catch (error) {
      console.error("An error occurred during the request:", error);
      alert("An unexpected error occurred. Please try again.");
    }

  }, true);

</script>
